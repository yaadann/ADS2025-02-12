# Название

Матричные коэффициенты по модулю

# Описание

Матричные коэффициенты по модулю

## Описание

В кристаллографии часто возникает задача вычисления специальных матричных коэффициентов, характеризующих симметрию кристаллической решётки. Эти коэффициенты определяются через факториалы и требуют вычисления по простому модулю для избежания переполнения при больших значениях параметров.

Дано целое число `n` и простой модуль `p = 10^9 + 7`. Нужно вычислить матричный коэффициент по формуле:

$$\text{коэффициент} = \frac{(n!)^2}{(2n)!} \pmod{p}$$

где все операции выполняются по модулю `p`, включая деление (которое реализуется через умножение на обратный элемент по модулю).

## Входные данные

Первая строка содержит одно целое число `n` (1 ≤ n ≤ 100 000).

## Выходные данные

Вывести одно целое число — значение матричного коэффициента по модулю `p = 10^9 + 7`.

## Пример

**Входные данные:**
```
5
```

**Выходные данные:**
```
119813081
```

## Ограничения

- 1 ≤ n ≤ 100 000
- Модуль p = 1 000 000 007 (простое число)
- Гарантируется, что обратный элемент всегда существует для данных ограничений

# Краткая теория

Деление по модулю в модулярной арифметике

## Введение

При решении задач на вычисления по модулю часто требуется выполнять операцию деления. Однако деление в модулярной арифметике определено не так, как в обычной математике. Прямое деление по модулю некорректно: результат \(a / b \pmod{p}\) нельзя получить просто вычислив \((a \bmod p) / (b \bmod p)\).

Например: \(10 / 5 = 2\), но \(10 \equiv 1 \pmod{3}\) и \(5 \equiv 2 \pmod{3}\), однако \(1 / 2 \not\equiv 2 \pmod{3}\).

## Обратный элемент по модулю

**Определение:** Обратный элемент числа \(a\) по модулю \(p\) — это такое число \(a^{-1}\), что:

$$a \cdot a^{-1} \equiv 1 \pmod{p}$$

Обратный элемент существует только при условии, что \(\gcd(a, p) = 1\). Для простого модуля \(p\) обратный элемент существует для всех \(a\), где \(1 \leq a < p\).

**Вычисление деления через обратный элемент:**

$$\frac{a}{b} \pmod{p} = a \cdot b^{-1} \pmod{p}$$

Таким образом, задача деления по модулю сводится к нахождению обратного элемента.

## Малая теорема Ферма

**Теорема:** Если \(p\) — простое число и \(\gcd(a, p) = 1\), то:

$$a^{p-1} \equiv 1 \pmod{p}$$

Из этого следует, что:

$$a \cdot a^{p-2} \equiv a^{p-1} \equiv 1 \pmod{p}$$

Следовательно, обратный элемент можно вычислить по формуле:

$$a^{-1} \equiv a^{p-2} \pmod{p}$$

## Вычисление обратного элемента через бинарное возведение в степень

Для эффективного вычисления \(a^{p-2} \pmod{p}\) используется алгоритм бинарного возведения в степень (fast exponentiation), который работает за \(O(\log p)\) операций.

**Алгоритм:**

```
binpow(a, n, p):
    result = 1
    while n > 0:
        if n нечетно:
            result = (result * a) % p
        a = (a * a) % p
        n = n // 2
    return result

modularInverse(a, p):
    return binpow(a, p - 2, p)
```

**Преимущества метода:**
- Работает для любого простого модуля
- Простая реализация
- Асимптотика \(O(\log p)\)

## Применение в комбинаторике

Деление по модулю особенно часто требуется при вычислении факториалов и биномиальных коэффициентов.

**Пример:** Вычисление факториала по модулю:

$$n! \pmod{p} = (1 \cdot 2 \cdot 3 \cdot ... \cdot n) \pmod{p}$$

Если нужно вычислить несколько факториалов, имеет смысл предподсчитать их:

```
factorial[0] = 1
for i = 1 to n:
    factorial[i] = (factorial[i-1] * i) % p
```

## Обратные факториалы

Если часто требуется выполнять деление на факториалы, имеет смысл предподсчитать обратные факториалы:

1. Вычислить \(n!\) обычным способом
2. Найти обратный элемент: \((n!)^{-1} \equiv (n!)^{p-2} \pmod{p}\)
3. Вычислить остальные обратные: \(((n-1)!)^{-1} = (n!)^{-1} \cdot n \pmod{p}\)

**Алгоритм:**
```
factorial[0] = 1
for i = 1 to n:
    factorial[i] = (factorial[i-1] * i) % p

inverse_factorial[n] = binpow(factorial[n], p - 2, p)
for i = n - 1 down to 0:
    inverse_factorial[i] = (inverse_factorial[i+1] * (i+1)) % p
```

## Практический пример

Вычислим \(\frac{10}{3} \pmod{7}\):

1. Находим \(3^{-1} \pmod{7}\): \(3^{7-2} = 3^5 = 243 \equiv 5 \pmod{7}\)
2. Проверка: \(3 \cdot 5 = 15 \equiv 1 \pmod{7}\) ✓
3. Результат: \(10 \cdot 5 = 50 \equiv 1 \pmod{7}\)

Проверим: \(10 \equiv 3 \pmod{7}\), \(3 \div 3 = 1 \pmod{7}\) ✓

## Почему выбран модуль \(10^9 + 7\)?

- Это простое число
- Достаточно большое, чтобы избежать переполнения при сложении двух чисел типа \(int\)
- Достаточно большое, чтобы при умножении двух чисел типа \(int\) результат уместился в \(long\) \(long\)
- Легко вводится в код: \(10^9 + 7 = 1000000007\)

## Резюме

Деление по модулю \(p\) сводится к умножению на обратный элемент. Для простого модуля \(p\) обратный элемент числа \(a\) можно вычислить по формуле \(a^{p-2} \pmod{p}\) согласно малой теореме Ферма. Это позволяет эффективно выполнять деление в модулярной арифметике за логарифмическое время.

