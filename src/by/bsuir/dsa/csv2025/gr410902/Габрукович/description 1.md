# Название

Изоморфные подстроки

# Описание

Изоморфные подстроки

## Условие задачи

Дана строка `S` длиной до 2⋅10^5 символов.  
Также дано `Q` запросов. Каждый запрос содержит четыре числа: `L1`, `R1`, `L2`, `R2`.

Для каждого запроса необходимо определить, являются ли подстроки `S[L1..R1]` и `S[L2..R2]` изоморфными.

Изоморфные строки — это строки, которые можно превратить друг в друга заменой символов по правилу:  
- каждому символу первой строки соответствует один символ второй строки;  
- разные символы первой строки не могут соответствовать одному символу второй;  
- порядок символов сохраняется.

Вывод: для каждого запроса `YES`, если подстроки изоморфны, иначе `NO`.

Критерии реализации:
- Использование **двойного полиномиального хеширования**:  
- Каждая подстрока кодируется в последовательность чисел по первому появлению символов;  
- Вычисляется хеш по двум модулям;  
- Сравнение хешей двух подстрок даёт ответ `YES`/`NO`;  
- Позволяет обрабатывать строки длиной до 2⋅10^5 и большое число запросов.

---

# Краткая теория

Изоморфные подстроки

При проверке изоморфизма подстрок прямое сравнение символов может быть слишком медленным для больших строк и большого числа запросов. Решение — использовать **хеширование паттернов символов**.

## Идея хеширования

Каждая подстрока кодируется в последовательность чисел по первому появлению символов:  
- первый встреченный символ получает код `0`;  
- новый символ получает следующий код `1, 2, 3 …`;  
- повторяющийся символ получает прежний код.  

Затем эта последовательность кодов превращается в одно число — хеш. Если хеши двух подстрок совпадают, то они с большой вероятностью изоморфны.

## Коллизии хешей

*Коллизия* — это случай, когда хеши двух разных подстрок совпали.  
- Если длина строки `n` и мы используем модуль `m`, вероятность коллизии примерно равна \(\Theta(n^2/m)\).  
- Для практических задач безопасно брать модуль порядка `10 * n^2`.  

Чтобы уменьшить вероятность коллизий, применяют **двойное хеширование**:  
- Вычисляют два хеша с разными модулями;  
- Сравнивают обе пары хешей.  

Это делает вероятность коллизии практически нулевой, даже для больших строк (до 2⋅10^5) и большого числа запросов.

## Выбор констант

- Модули должны быть большими простыми числами, чтобы минимизировать вероятность коллизий.  
- Базу хеширования (BASE) выбирают случайно, относительно большой, не делящийся на модули.  
- Для ещё большей безопасности можно использовать три модуля, но чаще достаточно двух.

## Пример применения

Если мы хотим проверить, изоморфны ли подстроки `S[1..5]` и `S[6..10]`:
1. Строим последовательности кодов для каждой подстроки.  
2. Вычисляем хеши для обеих последовательностей по двум модулям.  
3. Сравниваем пары хешей: если совпадают → `YES`, иначе → `NO`.

---

**Примечание:** двойное полиномиальное хеширование позволяет быстро проверять изоморфизм подстрок без прямого перебора символов и эффективно работает на больших данных.


