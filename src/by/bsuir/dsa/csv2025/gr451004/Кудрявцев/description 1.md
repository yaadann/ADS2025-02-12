# Название

Многооперационный ним с ограничениями

# Описание

Многооперационный Ним с ограничениями

## Условие задачи
Дано `n` кучек камней, где в `i`-ой кучке находится `a_i` камней. Также заданы два целых числа `k` и `m` (1 ≤ `k` ≤ `n`, 2 ≤ `m` ≤ 10).

За один ход игрок может выполнить **ровно одну** из следующих операций:

1. **Стандартный ход Нима**: Выбрать одну кучку и удалить из нее любое ненулевое количество камней.

2. **Групповой ход (k-ним)**: Выбрать от 1 до `k` кучек и удалить из каждой выбранной кучки ровно один камень (только из непустых кучек).

3. **Деление кучки (модульная операция)**: Выбрать кучку с количеством камней, делящимся на `m`, и заменить ее на `m` кучек с количеством камней, равным исходному количеству, деленному на `m`. Например, если `m = 3`, кучку из 9 камней можно заменить на три кучки по 3 камня каждая.
Игрок, который не может сделать ход (все кучки пустые или нет возможности выполнить ни одну из операций), проигрывает.
Требуется определить, кто выиграет при оптимальной игре обоих игроков, если первый игрок ходит первым.

## Ограничения
- 1 ≤ `n` ≤ 10
- 1 ≤ `a_i` ≤ 50 для всех `i`
- Количество тестовых случаев в одном файле не превосходит 20

## Входные данные
- Первая строка: количество тестовых случаев
- Для каждого тестового случая:
  - Первая строка: три целых числа `n`, `k`, `m`
  - Вторая строка: `n` целых чисел `a_1`, `a_2`, ..., `a_n`

## Выходные данные
Для каждого тестового случая вывести одну строку:
- `"First"`, если выигрывает первый игрок
- `"Second"`, если выигрывает второй игрок

# Краткая теория

Теория игр: Анализ игры "Ним"

## Классическая игра Ним

Представьте игру, где перед вами лежит несколько групп камней. Участники по очереди берут камни из любой одной группы, при этом за один ход можно взять любое количество камней (но как минимум один). Побеждает тот, кто забирает последний камень.

Математически эту игру можно описать как набор неотрицательных целых чисел $a_1, a_2, \ldots, a_n$, где каждое число представляет количество камней в соответствующей группе. Ход игрока заключается в уменьшении одного из этих чисел, а финальная позиция — когда все числа равны нулю.

**Ключевая теорема.** Позиция в игре выигрышна для текущего игрока тогда и только тогда, когда побитовое XOR всех размеров групп не равно нулю.

**Обоснование** строится по принципу математической индукции:

1. **Базовый случай:** когда камней не осталось, XOR равен нулю, и позиция проигрышна (игрок не может сделать ход).

2. **Переход для нулевого XOR:** если текущий XOR равен нулю, то любой ход приведет к ненулевому XOR. Это происходит потому, что изменение любого $a_i$ на $b_i$ (где $b_i < a_i$) изменит общую XOR-сумму.

3. **Переход для ненулевого XOR:** если текущий XOR ($S$) не равен нулю, всегда существует ход, делающий XOR равным нулю. Для этого нужно найти группу $a_i$, у которой установлен старший бит $S$, и уменьшить её до значения $S \oplus a_i$.

Почему $S \oplus a_i < a_i$? Потому что при таком преобразовании старший бит, где $S$ и $a_i$ имеют единицу, обнуляется, а изменения в младших разрядах не могут компенсировать это уменьшение.

**Стратегия победы:** вычисляйте XOR всех групп. Если он не нулевой, найдите группу с установленным старшим битом XOR-суммы и измените её размер до $S \oplus a_i$. Если XOR равен нулю — вы в проигрышной позиции при условии оптимальной игры противника.

## Вариации игры Ним

### Обратный Ним (misère nim)

В этой вариации побеждает не тот, кто берет последний камень, а наоборот — игрок, который вынужден взять последний камень, проигрывает.
Удивительно, но оптимальная стратегия почти идентична классическому Ниму. Основное отличие проявляется только когда все группы содержат ровно по одному камню. В этом специальном случае выигрышные и проигрышные позиции меняются местами по сравнению с обычным Нимом.

**Как играть:** следуйте стандартной стратегии Нима (стремитесь к нулевому XOR), но когда ваш ход приведет к ситуации, где все оставшиеся группы содержат по одному камню, измените стратегию: сделайте ход так, чтобы количество непустых групп изменило свою четность.

**Почему это работает?** Рано или поздно игра придет к состоянию, где все непустые группы содержат по одному камню. Если в этот момент количество таких групп четное — текущий игрок выиграет в обратном Ниме. Анализируя игру в обратном направлении, можно показать, что при наличии хотя бы двух групп размером больше единицы стратегия совпадает со стандартной.

### Расширенный Ним (k-ним или Ним Мура)

В этой вариации игрок за один ход может брать камни из от одной до $k$ групп одновременно (взяв минимум один камень из каждой выбранной группы).

**Решение:** представьте размер каждой группы в двоичной системе. Для каждого разряда подсчитайте сумму единиц по всем группам и возьмите результат по модулю $(k+1)$. Если во всех разрядах получается ноль — позиция проигрышна, иначе — выигрышна.

**Обоснование стратегии** аналогично классическому Ниму, но с дополнительной сложностью из-за возможности изменения нескольких групп одновременно:

- Из нулевой позиции (где все разряды дают ноль по модулю $k+1$) любой ход приведет к ненулевой позиции.
- Из ненулевой позиции всегда можно найти ход к нулевой, правильно выбрав группы для изменения.
Для последнего утверждения используется пошаговое обнуление проблемных разрядов от старших к младшим, контролируя общее количество изменяемых групп.

## Значение игры Ним в теории игр

Термин "цугцванг" (от немецких слов "zug" — ход и "zwang" — принуждение) описывает ситуацию, когда игрок вынужден сделать ход, ухудшающий его позицию. Многие стратегические игры содержат подобные элементы.
Удивительный факт: огромное количество игр, основанных на принципе цугцванга, можно свести к игре Ним. Это позволяет использовать разработанные для Нима математические методы для анализа самых разных игровых ситуаций.

