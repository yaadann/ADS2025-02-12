# Название

Оптимизация отрисовки

# Описание

Оптимизация отрисовки

## Описание задачи

В графических движках длинные полилинии, состоящие из большого числа вершин, могут значительно замедлять отрисовку. Меньшее количество вершин означает меньше операций рисования. Ваша задача — реализовать **упрощение полилинии**, сохраняя её форму в пределах допустимой погрешности.

### Формат входных данных

- Первая строка: два значения `N eps`  
  - `N` — количество вершин (`N ≥ 2`)  
  - `eps` — допустимая погрешность (вещественное число)

- Далее `N` строк:  
  `x y` — координаты каждой вершины полилинии в порядке обхода.  
  Полилиния может быть открытой или замкнутой (последняя точка может совпадать с первой).

### Формат выходных данных

- Первая строка: целое число `M` — количество вершин после упрощения  
- Далее `M` строк: координаты упрощённой полилинии, `x y` с **трёхзначной точностью** после запятой

### Ограничения

- `2 ≤ N ≤ 200000`  
- `eps ≥ 0`  
- Координаты — числа с плавающей точкой двойной точности

### Цель

Реализовать **алгоритм Дугласа–Пекера (Douglas–Peucker)** для уменьшения числа вершин полилинии с сохранением формы с точностью не более `eps`.


# Краткая теория

Алгоритм Дугласа–Пекера — Теория

**Алгоритм Дугласа–Пекера (DP)** рекурсивно упрощает полилинию, сохраняя её форму с точностью \(\varepsilon\).

### Основные шаги

1. Берём отрезок между первой и последней точками текущей под-полилинии.  
2. Находим точку \(P\) с **максимальным перпендикулярным расстоянием** \(d_{\max}\) до этого отрезка.  
3. Если \(d_{\max} > \varepsilon\), рекурсивно упрощаем две части:  
   - от первой точки до \(P\)  
   - от \(P\) до последней точки  
4. Если \(d_{\max} \le \varepsilon\), все промежуточные точки заменяем только концами.

---

### Расстояние от точки до отрезка

Пусть \(A(x_1, y_1)\) и \(B(x_2, y_2)\) задают отрезок, а \(P(x_0, y_0)\) — точка.  

Перпендикулярное расстояние до **прямой** через \(A\) и \(B\):

\[
d_{\text{line}}(P, AB) = \frac{|(x_2 - x_1)(y_1 - y_0) - (x_1 - x_0)(y_2 - y_1)|}{\sqrt{(x_2 - x_1)^2 + (y_2 - y_1)^2}}
\]

Для **отрезка**: если проекция точки \(P\) на прямую лежит за пределами \(AB\), расстояние равно расстоянию до ближайшей вершины:

\[
d_{\text{segment}}(P, AB) =
\begin{cases} 
\|P - A\| & \text{если проекция перед } A \\
\|P - B\| & \text{если проекция после } B \\
d_{\text{line}}(P, AB) & \text{если проекция на отрезке}
\end{cases}
\]

---

### Сложность

- **Время:** худший случай \(O(N^2)\) (редко встречается на практике)  
- **Память:** глубина рекурсивного стека ≤ \(N\)  
- **Практическая производительность:** очень быстро для обычных полилиний, может уменьшить тысячи точек до нескольких десятков


